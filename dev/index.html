<html>
    <head>
        <title>Screen Recorder</title>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&family=Nunito:wght@400;700&display=swap" rel="stylesheet">

        <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

        <style>
            .loader,
            .loader:after {
            border-radius: 50%;
            width: 10em;
            height: 10em;
            }
            .loader {
            margin: 60px auto;
            font-size: 10px;
            position: relative;
            text-indent: -9999em;
            border-top: 1.1em solid rgba(255, 255, 255, 0.2);
            border-right: 1.1em solid rgba(255, 255, 255, 0.2);
            border-bottom: 1.1em solid rgba(255, 255, 255, 0.2);
            border-left: 1.1em solid #ffffff;
            -webkit-transform: translateZ(0);
            -ms-transform: translateZ(0);
            transform: translateZ(0);
            -webkit-animation: load8 1.1s infinite linear;
            animation: load8 1.1s infinite linear;
            }
            @-webkit-keyframes load8 {
            0% {
                -webkit-transform: rotate(0deg);
                transform: rotate(0deg);
            }
            100% {
                -webkit-transform: rotate(360deg);
                transform: rotate(360deg);
            }
            }
            @keyframes load8 {
            0% {
                -webkit-transform: rotate(0deg);
                transform: rotate(0deg);
            }
            100% {
                -webkit-transform: rotate(360deg);
                transform: rotate(360deg);
            }
            }

            html, body {
                /** font-family: 'Noto Sans TC', sans-serif; **/
                font-family: 'Nunito', 'Noto Sans TC', sans-serif;
                font-weight: 300;
                background-image: url("images/background.png");
                background-size: 100% 100%;
                user-select: none; 
                overflow-x: hidden;
            }
            .main {
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                width: 100%;
                height: 100%;
            }
            .main-card {
                width: 100%;
                height: 100%;
                max-width: 900px;
                max-height: 600px;
                padding: 20px;
                border: none;
                border-radius: 6.6px;
                background-color: rgba(255, 255, 255, 0.75);
                backdrop-filter: blur(40px);
                -webkit-box-shadow: 0px 15px 20px -8px rgba(0,0,0,0.18); 
                box-shadow: 0px 15px 20px -8px rgba(0,0,0,0.18);
                /*-webkit-box-shadow: 0px 0px 18px 6px rgba(0,0,0,0.08); */
                /*box-shadow: 0px 0px 18px 6px rgba(0,0,0,0.08);*/
            }
            .main-card-row {
                height: 100%;
            }
            .main-card-col {
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                justify-content: space-between;
            }
            .main-card-icon-col {
                justify-content: center;
            }
            .icon {
                color: rgb(39, 101, 192);
                filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.2));
            }
            .title {
                font-family: 'Nunito', 'Noto Sans TC', sans-serif;
                font-weight: bold;
            }
            .title-beta {
                font-family: 'Nunito', 'Noto Sans TC', sans-serif;
                font-weight: bold;
                color: gray;
            }
            .start-button {
                padding-left: 44px;
                padding-right: 44px;
            }
            /*.btn:focus {*/
            /*    box-shadow: none !important;*/
            /*}*/
            /*.btn:active {*/
            /*    box-shadow: 0 0 0 1px white, 0 0 0 3px black !important;*/
            /*}*/
            .btn-primary {
                background-color: rgb(39, 101, 192);
                border-color: rgb(39, 101, 192);
            }
            .btn-primary:hover {
                background-color: rgb(18, 48, 103);
            }
            .form-select {
                border: none;
                background-color: rgba(0, 0, 0, 0.04);
            }
            ul.option {
                padding: 0;
                margin: 0;
            }
            ul.option > li {
                list-style-type: none;
                padding: 16px;
                margin-bottom: 6px;
                border-radius: 4px;
                transition-duration: 200ms;
                transition-property: background, color;
            }
            ul.option > li[disabled] {
                opacity: 0.3;
            }
            ul.option > li:hover:not([disabled]):not(.select) {
                background: rgba(0, 0, 0, 0.04);
            }
            ul.option > li:active:not([disabled]) {
                color: white;
                background: rgb(18, 48, 103);
            }
            ul.option > li.select {
                color: white;
                background: rgb(39, 101, 192);
            }
            ul.option > li > p {
                color: gray;
                transition-duration: 200ms;
                transition-property: background, color;
            }
            ul.option > li:active:not([disabled]) > p {
                color: lightgray;
            }
            ul.option > li.select > p {
                color: lightgray;
            }
            .footer {
                width: 100%;
                max-width: 900px;
                color: gray;
                margin-top: 14px;
                margin-bottom: 14px;
                margin-left: 14px;
                font-size: 9px;
                text-align: left;
            }
            @media only screen and (max-width: 600px) {
                .main-card {
                    max-height: none !important;
                }
                .footer {
                    text-align: center;
                }
            }
        </style>
        <script>
            document.oncontextmenu = function(){
                event.returnValue = false;
            }
        </script>
    </head>
    <body>
        <div class="main animate__animated animate__zoomIn animate__faster">
            <!-- <div class="loading animate__animated animate__fadeOut animate__delay-2s animate__faster">
                <div class="loader">Loading...</div>
            </div> -->
            <div class="card main-card">
                <div class="card-body">

                    <div id="welcome">
                        <div class="row main-card-row">
                            <div class="col main-card-col main-card-icon-col">
                                <div class="icon">
                                    <i class="fas fa-video fa-9x"></i>
                                </div>
                            </div>
                            <div class="col main-card-col">
                                <div style="display:flex;">
                                    <h2 class="title">OScreenRecorder</h1>
                                    &nbsp;&nbsp;
                                    <h5 class="title-beta">BETA</h5>
                                </div>
                                <div style="display:flex;flex-direction:column;">
                                    <p>線上錄製螢幕，無需下載客戶端，無限時長，無需費用。</p>
                                    <p>支援影片檔案下載(*.webm)，支援螢幕、視窗、分頁錄製。</p>
                                </div>
                                <div style="display:flex;width:100%;flex-direction:row;justify-content:flex-end;">
                                    <button type="button" class="btn btn-primary start-button next">開 始</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="select-capture-mode" style="display:none;">
                        <div class="row main-card-row">
                            <div class="col main-card-col main-card-icon-col">
                                <div class="icon">
                                    <i class="fas fa-desktop fa-9x"></i>
                                </div>
                            </div>
                            <div class="col main-card-col">
                                <div style="display:flex;width:100%;">
                                    <h4>選擇擷取模式</h1>
                                </div>
                                <div style="display:flex;flex-direction:column;">
                                    <ul class="option" id="capture-option">
                                        <li disabled>
                                            <h6>擷取螢幕畫面和視訊鏡頭(開發中)</h6>
                                            <p>
                                                在螢幕右下方使用子母畫面(PiP)顯示視訊鏡頭畫面，在螢幕錄製時同時錄製。
                                                請注意，若視窗覆蓋在子母畫面之上，將無法擷取視訊畫面。
                                            </p>
                                        </li>
                                        <li>
                                            <h6>僅擷取螢幕畫面</h6>
                                            <p>
                                                將只會擷取您選擇的螢幕畫面，不會擷取視訊鏡頭影像。
                                            </p>
                                        </li>
                                    </ul>
                                </div>
                                <div style="display:flex;width:100%;flex-direction:row;justify-content:flex-end;">
                                    <button type="button" class="btn back">上一步</button>
                                    &nbsp;&nbsp;
                                    <button type="button" class="btn btn-primary start-button next" disabled>下一步</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="select-audio-mode" style="display:none;">
                        <div class="row main-card-row">
                            <div class="col main-card-col main-card-icon-col">
                                <div class="icon">
                                    <i class="fas fa-music fa-9x" id="audio-icon"></i>
                                </div>
                            </div>
                            <div class="col main-card-col">
                                <div style="display:flex;width:100%;">
                                    <h4>選擇音訊模式</h1>
                                </div>
                                <div style="display:flex;flex-direction:column;">
                                    <ul class="option" id="audio-option">
                                        <li>
                                            <h6>無音訊</h6>
                                            <p>
                                                影片將不會有任何聲音。
                                            </p>
                                        </li>
                                        <li>
                                            <h6>擷取麥克風音訊</h6>
                                            <p>
                                                擷取電腦上的麥克風聲音。
                                            </p>
                                        </li>
                                        <li>
                                            <h6>擷取螢幕音訊</h6>
                                            <p>
                                                擷取目標畫面的聲音。部分作業系統或瀏覽器不支援。
                                            </p>
                                        </li>
                                    </ul>
                                </div>
                                <div style="display:flex;width:100%;flex-direction:row;justify-content:flex-end;">
                                    <button type="button" class="btn back">上一步</button>
                                    &nbsp;&nbsp;
                                    <button type="button" class="btn btn-primary start-button next" disabled>下一步</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="other-settings" style="display:none;">
                        <div class="row main-card-row">
                            <div class="col main-card-col main-card-icon-col">
                                <div class="icon">
                                    <i class="fas fa-tools fa-9x" id="audio-icon"></i>
                                </div>
                            </div>
                            <div class="col main-card-col">
                                <div style="display:flex;width:100%;">
                                    <h4>其他選項</h1>
                                </div>
                                <div style="display:flex;flex-direction:column;width:100%;">
                                    <h6><i class="fas fa-mouse-pointer"></i> 游標</h6>
                                    <select class="form-select form-select-lg mb-3">
                                        <option value="0" selected>總是顯示</option>
                                        <option value="1">移動時顯示</option>
                                        <option value="2">不顯示</option>
                                      </select>
                                </div>
                                <div style="display:flex;width:100%;flex-direction:row;justify-content:flex-end;">
                                    <button type="button" class="btn back">上一步</button>
                                    &nbsp;&nbsp;
                                    <button type="button" class="btn btn-primary start-button" id="prepare">請求錄製權限</button>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
            </div>
            <div class="footer">Copyright © 2021 CISH Networking Team</div>
        </div>

        <script type="text/javascript">
            var pages = ['#welcome', '#select-capture-mode', '#select-audio-mode', '#other-settings'];

            function changePage(pageNumber) {
                pages.forEach(function (page) {
                    $(page).hide();
                });
                $(pages[pageNumber]).fadeIn('slow');
            }
            var nowPage = 0;
            $('.back').click(function () {
                if(nowPage > 0) {
                    nowPage--;
                    changePage(nowPage);
                }
            });
            $('.next').click(function () {
                if(nowPage < pages.length-1) {
                    nowPage++;
                    changePage(nowPage);
                }
            });

            const isPiPAvailable = () => {
                return document.pictureInPictureEnabled || !videoElement.disablePictureInPicture;
            }

            var captureMode = 0;
            $('#capture-option > li').each(function (index) {
                if(!$(this).is('[disabled]')) {
                    $(this).click(function () {
                        $('#capture-option > li').each(function () {
                            $(this).removeClass('select');
                        });
                        $(this).addClass('select');
                        $('#select-capture-mode .next').removeAttr('disabled');
                        captureMode = index;
                    });
                }
            });

            var audioMode = 0;
            var audioIcon = ['fa-music', 'fa-volume-off', 'fa-microphone', 'fa-volume-up']
            $('#audio-option > li').each(function (index) {
                if(!$(this).is('[disabled]')) {
                    $(this).click(function () {
                        $('#audio-option > li').each(function () {
                            $(this).removeClass('select');
                        });
                        $(this).addClass('select');
                        $('#select-audio-mode .next').removeAttr('disabled');
                        captureMode = index;
                        audioIcon.forEach(function (icon) {
                            $('#audio-icon').removeClass(icon);
                        });
                        $('#audio-icon').addClass(audioIcon[captureMode+1]);
                    });
                }
            });

            console.log("SupportPiP:" + isPiPAvailable());
        </script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    </body>
</html>